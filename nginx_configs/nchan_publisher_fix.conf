# Fix for nchan publisher - add to default server block
# This allows PHP to publish via localhost

location = /internal/publish/booking {
    # Only on localhost/127.0.0.1
    if ($host != "127.0.0.1") {
        return 403;
    }
    
    nchan_publisher;
    nchan_channel_id $arg_channel;
    nchan_store_messages on;
    nchan_message_timeout 5m;
    
    # Only accessible from localhost
    allow 127.0.0.1;
    allow ::1;
    deny all;
}